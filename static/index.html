<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–ß–∏—Ç–∞—Ä–∏—É–º</title>
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&family=Cinzel:wght@600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0d1a;
  --gold:#D4AF37;
  --gold-soft:rgba(212,175,55,.25);
  --text:#F2E8C9;
  --muted:rgba(242,232,201,.7);
  --card:rgba(245,231,196,.08);
  --line:rgba(212,175,55,.25);
  --radius:18px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Nunito",sans-serif;
  color:var(--text);
  min-height:100vh;
  background:#05060f; /* –±–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç, –Ω–æ –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:.08;
  background-image:
    repeating-linear-gradient(
      0deg,
      rgba(255,255,255,.03) 0px,
      rgba(255,255,255,.03) 1px,
      rgba(0,0,0,0) 2px,
      rgba(0,0,0,0) 4px
    );
  mix-blend-mode: overlay;
}

.wrap{
  max-width: none;           /* –±—ã–ª–æ: 1000px/980px */
  width: 100%;
  margin: 0;
  padding: 24px 24px 44px;   /* –º–æ–∂–Ω–æ 16/24 –ø–æ –≤–∫—É—Å—É */
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:24px;
}
h1{
  font-family:"Cinzel",serif;
  margin:0;
  font-size:24px;
}
.sub{color:var(--muted);font-weight:800;font-size:13px}

.card{
  width: min(1200px, calc(100vw - 48px));  /* —à–∏—Ä–æ–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
  margin: 0 auto;                          /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º */
  padding: 18px;

  border-radius: 22px;
  border: 1px solid rgba(212,175,55,.22);

  /* –≤–º–µ—Å—Ç–æ —Å—Ç–µ–∫–ª–∞ ‚Äî —Ç—ë–º–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –ø–æ–¥ —Ç–µ–∫—Å—Ç */
  background: linear-gradient(
    180deg,
    rgba(10,12,20,.78),
    rgba(10,12,20,.62)
  );

  box-shadow: 0 22px 48px rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  position: relative;
}

/* –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π scrim (–≥–ª–∞–≤–Ω—ã–π –±—É—Å—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏) */
.card::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  background:
    radial-gradient(900px 380px at 50% 0%, rgba(0,0,0,.28), rgba(0,0,0,0) 62%),
    linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.42));
  pointer-events:none;
}
.card > *{ position: relative; z-index: 1; }

.btn{
  padding:12px 16px;
  border-radius:14px;
  border:1px solid var(--line);
  background:rgba(0,0,0,.2);
  color:var(--text);
  font-weight:900;
  cursor:pointer;
  transition:.15s;
}
.btn:hover{border-color:var(--gold)}
.btn-primary{
  background:linear-gradient(135deg,rgba(212,175,55,.35),rgba(212,175,55,.15));
  border-color:var(--gold);
}

.hidden{display:none}
.screen{display:none}
.screen.active{display:block}

.games{
  gap:16px;
  margin-top:16px;
}
.gameCard{
  padding:18px;
  border-radius:16px;
  border:1px solid var(--gold-soft);
  background:rgba(0,0,0,.2);
  cursor:pointer;
  font-weight:900;
  text-align:left;
  margin-top: 10px;
}
.gameCard:hover{border-color:var(--gold)}

.grid{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.wordBox{
  min-height:260px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:18px;
  border:1px dashed var(--gold-soft);
  background:radial-gradient(600px 200px at 50% 30%, rgba(212,175,55,.1), transparent);
}
.word{
  font-size:64px;
  font-weight:900;
}
.options{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.progress{
  height:10px;
  background:rgba(0,0,0,.2);
  border-radius:999px;
  overflow:hidden;
}
.progress div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--gold),orange);
}
input, select{
  width: 100%;
  max-width: 360px;
  padding: 12px 44px 12px 14px;
  border-radius: 14px;
  border: 1px solid rgba(212,175,55,.28);
  background: rgba(0,0,0,.22);
  color: var(--text);
  font-weight: 900;
  font-size: 16px;
  outline: none;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.10);
}

input::placeholder{ color: rgba(242,232,201,.55); }

input:focus, select:focus{
  border-color: rgba(212,175,55,.55);
  box-shadow: 0 0 0 4px rgba(212,175,55,.10);
}

/* –∫–∞—Å—Ç–æ–º–Ω—ã–π select */
select{
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;

  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23D4AF37' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  background-size: 18px 18px;
}

/* —á—Ç–æ–±—ã options –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º –±—ã–ª–∏ —á–∏—Ç–∞–µ–º—ã–º–∏ */
select option{
  color: #1a1a1a;
}

/* –µ—Å–ª–∏ —Å–µ–ª–µ–∫—Ç—ã —Å—Ç–æ—è—Ç –≤ –∫–æ–ª–æ–Ω–∫—É ‚Äî –±—É–¥–µ—Ç —Ä–æ–≤–Ω–µ–µ */
#screen-setup select, #screen-setup input{
  display:block;
  margin-top: 10px;
}
/* ===== –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞ –∫–∞–∫ "–∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è" ===== */
#options .opt{
  -webkit-appearance:none;
  appearance:none;

  width:100%;
  padding: 14px 16px;
  border-radius: 16px;

  color: var(--text);
  font-weight: 900;
  font-size: 20px;
  letter-spacing: .2px;

  background:
    radial-gradient(600px 120px at 50% 0%, rgba(212,175,55,.10), rgba(0,0,0,0) 65%),
    linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.28));

  border: 1px solid rgba(212,175,55,.32);
  box-shadow:
    0 12px 22px rgba(0,0,0,.35),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 18px rgba(212,175,55,.08); /* –±–∞–∑–æ–≤–æ–µ –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */

  cursor:pointer;
  transition: transform .08s ease, box-shadow .14s ease, border-color .14s ease, filter .14s ease;
  position: relative;
  overflow: hidden;
}

/* "–∏—Å–∫—Ä—ã" –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ */
#options .opt::before{
  content:"";
  position:absolute;
  inset:-40px;
  background:
    radial-gradient(12px 10px at 18% 35%, rgba(242,193,78,.18), rgba(0,0,0,0) 60%),
    radial-gradient(10px 8px at 55% 20%, rgba(212,175,55,.14), rgba(0,0,0,0) 60%),
    radial-gradient(14px 12px at 78% 60%, rgba(139,92,246,.10), rgba(0,0,0,0) 62%),
    radial-gradient(10px 8px at 35% 75%, rgba(212,175,55,.12), rgba(0,0,0,0) 60%);
  opacity:.55;
  transform: rotate(6deg);
  pointer-events:none;
}

/* —Å–∏—è–Ω–∏–µ –ø–æ –∫—Ä–∞—è–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
#options .opt:hover{
  border-color: rgba(212,175,55,.60);
  filter: brightness(1.05);
  box-shadow:
    0 16px 28px rgba(0,0,0,.42),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 26px rgba(212,175,55,.18),  /* –∑–æ–ª–æ—Ç–æ */
    0 0 10px rgba(242,193,78,.12);  /* —Ç—ë–ø–ª–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
}

#options .opt:active{
  transform: scale(.985);
}

/* –µ—Å–ª–∏ JS –¥–∏–∑–µ–π–±–ª–∏—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ */
#options .opt:disabled{
  opacity:.72;
  cursor:not-allowed;
  filter: saturate(.9);
}

/* –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Äî —Ü–≤–µ—Ç–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
#options .opt.ok{
  border-color: rgba(34,197,94,.62);
  box-shadow:
    0 16px 28px rgba(0,0,0,.42),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 34px rgba(34,197,94,.22),
    0 0 14px rgba(34,197,94,.14);
}

#options .opt.bad{
  border-color: rgba(239,68,68,.62);
  box-shadow:
    0 16px 28px rgba(0,0,0,.42),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 34px rgba(239,68,68,.18),
    0 0 14px rgba(239,68,68,.12);
}

/* –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –≤ –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É */
@media (max-width: 520px){
  #options{
    grid-template-columns: 1fr !important;
  }
}
/* ===== Letter Builder: –ø–ª–∏—Ç–∫–∏ –±—É–∫–≤ (override) ===== */
/* –≤–∞–∂–Ω–æ: –ø–µ—Ä–µ–±–∏–≤–∞–µ–º .options{ grid-template-columns:1fr 1fr } */
#options.lettersGrid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(84px, 1fr)) !important;
  gap: 14px !important;
  align-items: stretch;
}

/* –ø–µ—Ä–µ–±–∏–≤–∞–µ–º —Å–∏–ª—å–Ω—ã–π —Å—Ç–∏–ª—å #options .opt (padding/—Ä–∞–¥–∏—É—Å—ã/—Ñ–æ–Ω) */
#options.lettersGrid .opt{
  height: 76px;
  min-height: 76px;
  padding: 0 !important;
  border-radius: 16px !important;

  font-size: 36px !important;
  font-weight: 900 !important;
  letter-spacing: .02em;

  display:flex;
  align-items:center;
  justify-content:center;

  /* —É–±–∏—Ä–∞–µ–º ‚Äú–¥–ª–∏–Ω–Ω—ã–π‚Äù –≤–∏–¥ –∏–∑-–∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
  text-align:center;
}

/* –Ω–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–ª–∏—Ç–∫–∞–º–∏, –∞ –Ω–µ –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π */
@media (max-width: 520px){
  #options.lettersGrid{
    grid-template-columns: repeat(3, minmax(76px, 1fr)) !important;
  }
}
/* ===== –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (.btn) –≤ —Å—Ç–∏–ª–µ –•–æ–≥–≤–∞—Ä—Ç—Å–∞ ===== */
.btn{
  -webkit-appearance:none;
  appearance:none;

  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;

  padding: 12px 18px;
  border-radius: 16px;

  color: var(--text);
  font-weight: 900;
  font-size: 18px;
  letter-spacing: .15px;

  background:
    radial-gradient(520px 120px at 50% 0%, rgba(212,175,55,.10), rgba(0,0,0,0) 62%),
    linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.28));

  border: 1px solid rgba(212,175,55,.32);

  box-shadow:
    0 12px 22px rgba(0,0,0,.35),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 18px rgba(212,175,55,.08);

  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, box-shadow .14s ease, border-color .14s ease, filter .14s ease;
  position: relative;
  overflow: hidden;
}

.btn::before{
  content:"";
  position:absolute;
  inset:-40px;
  background:
    radial-gradient(12px 10px at 22% 35%, rgba(242,193,78,.16), rgba(0,0,0,0) 60%),
    radial-gradient(10px 8px at 55% 20%, rgba(212,175,55,.12), rgba(0,0,0,0) 60%),
    radial-gradient(14px 12px at 80% 62%, rgba(139,92,246,.09), rgba(0,0,0,0) 62%),
    radial-gradient(10px 8px at 38% 78%, rgba(212,175,55,.10), rgba(0,0,0,0) 60%);
  opacity:.55;
  transform: rotate(6deg);
  pointer-events:none;
}

.btn:hover{
  border-color: rgba(212,175,55,.60);
  filter: brightness(1.05);
  box-shadow:
    0 16px 28px rgba(0,0,0,.42),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 26px rgba(212,175,55,.18),
    0 0 10px rgba(242,193,78,.12);
}

.btn:active{ transform: scale(.985); }

.btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  filter: saturate(.85);
  box-shadow:
    0 10px 18px rgba(0,0,0,.28),
    0 0 0 1px rgba(0,0,0,.18) inset;
}

/* Primary ‚Äî –±–æ–ª–µ–µ ‚Äú–∑–æ–ª–æ—Ç–∞—è –º–∞–≥–∏—è‚Äù */
.btn-primary{
  border-color: rgba(212,175,55,.70);
  background:
    radial-gradient(520px 140px at 50% 0%, rgba(242,193,78,.18), rgba(0,0,0,0) 65%),
    linear-gradient(180deg, rgba(212,175,55,.14), rgba(0,0,0,.28));
  box-shadow:
    0 16px 28px rgba(0,0,0,.42),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 34px rgba(212,175,55,.22);
}

.btn-primary:hover{
  box-shadow:
    0 20px 34px rgba(0,0,0,.48),
    0 0 0 1px rgba(0,0,0,.18) inset,
    0 0 42px rgba(212,175,55,.28),
    0 0 14px rgba(242,193,78,.16);
}

/* Ghost ‚Äî –±–æ–ª–µ–µ —Å–ø–æ–∫–æ–π–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (–Ω–∞–∑–∞–¥/–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏) */
.btn-ghost{
  background:
    linear-gradient(180deg, rgba(0,0,0,.06), rgba(0,0,0,.24));
  border-color: rgba(212,175,55,.26);
  box-shadow:
    0 10px 18px rgba(0,0,0,.30),
    0 0 0 1px rgba(0,0,0,.18) inset;
}

/* –ß—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ */
#btnPlay, #btnRestart, #startGameBtn{
  padding: 13px 20px;
  font-size: 18px;
  border-radius: 18px;
}
.star{ opacity:.28; }
.star.on{ opacity:1; }
/* ===== –§–û–ù–´ –≠–ö–†–ê–ù–û–í ===== */

.screen{
  min-height:100vh;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
}
body {
  cursor: url("/static/cursor/magic-wand.cur"), auto !important;
}

/* —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
h1, .sub, .pill, .toast, .opt, .btn{
  text-shadow: 0 2px 10px rgba(0,0,0,.65);
}

.sub, .pill, .toast{
  color: rgba(242,232,201,.82);
}
/* =============================
   –§–û–ù –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø –° –°–ê–ú–û–ì–û –í–ï–†–•–ê
   ============================= */

body{
  margin:0;
  font-family:"Nunito",sans-serif;
  color:var(--text);
  min-height:100vh;

  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  background-attachment:fixed;
}

/* —Ñ–æ–Ω –ø–æ —ç–∫—Ä–∞–Ω–∞–º (–∫–ª–∞—Å—Å —Å—Ç–∞–≤–∏–º –Ω–∞ body —á–µ—Ä–µ–∑ JS) */
body.screen-main  { background-image:url("/static/img/bg-main.png"); }
body.screen-setup { background-image:url("/static/img/bg-setup.png"); }
body.screen-play  { background-image:url("/static/img/bg-play.png"); }
body.screen-result{ background-image:url("/static/img/bg-main.png"); }

/* –æ–≤–µ—Ä–ª–µ–π: —Å–ª–∞–±–µ–µ —Å–≤–µ—Ä—Ö—É (—á—Ç–æ–±—ã —à–∞–ø–∫–∞ —á–∏—Ç–∞–ª–∞—Å—å, –Ω–æ —Ñ–æ–Ω –±—ã–ª –≤–∏–¥–µ–Ω) */
body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:-1;
  background: linear-gradient(
    180deg,
    rgba(0,0,0,.28) 0%,
    rgba(0,0,0,.48) 45%,
    rgba(0,0,0,.70) 100%
  );
}

html, body, .wrap, .card, .screen,
button, .btn, .gameCard, .opt,
#options, #word, .wordBox {
  cursor: url("/static/cursor/magic-wand.cur") 32 32, pointer !important;
}
#sparkCanvas{
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 9999; /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
}
/* –§–∏–∫—Å–∏—Ä—É–µ–º –∫—É—Ä—Å–æ—Ä –≤–µ–∑–¥–µ */
html, body,
button, .btn, .gameCard, .opt,
input, select, textarea,
a, label,
#options, .wordBox, .card {
  cursor: url("/static/cursor/magic-wand.cur") 8 8, pointer !important;
}
/* === –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown === */
.cselect{ position:relative; max-width:360px; }
.cselect select{ display:none; } /* –ø—Ä—è—á–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π */

.cselect__btn{
  width:100%;
  text-align:left;
  padding: 12px 44px 12px 14px;
  border-radius: 14px;
  border: 1px solid rgba(212,175,55,.28);
  background: rgba(0,0,0,.22);
  color: var(--text);
  font-weight: 900;
  font-size: 16px;
  cursor: pointer;
  position: relative;
}

.cselect__btn::after{
  content:"";
  position:absolute;
  right:14px;
  top:50%;
  transform:translateY(-50%);
  width:18px; height:18px;
  background: no-repeat center/18px 18px url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23D4AF37' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  pointer-events:none;
}

.cselect__list{
  position:absolute;
  left:0; right:0;
  margin-top:8px;
  border-radius: 14px;
  border: 1px solid rgba(212,175,55,.28);
  background: rgba(10,12,20,.92);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: 0 22px 48px rgba(0,0,0,.55);
  overflow:hidden;
  z-index: 10000;
  display:none;
}

.cselect.open .cselect__list{ display:block; }

.cselect__opt{
  padding: 12px 14px;
  font-weight: 900;
  color: var(--text);
  cursor:pointer;
  user-select:none;
  border-top: 1px solid rgba(212,175,55,.12);
  background: transparent;
}

.cselect__opt:first-child{ border-top:0; }
.cselect__opt:hover{
  background: rgba(212,175,55,.12);
}
.cselect__opt[aria-selected="true"]{
  background: rgba(212,175,55,.18);
  outline: 1px solid rgba(212,175,55,.22);
}
.cselect select{
  display:none !important;
}
.cselect{
  position: relative;
  z-index: 50;      /* –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π –Ω–∞–¥ —Å–æ—Å–µ–¥—è–º–∏ */
}

/* —Å–∞–º —Å–ø–∏—Å–æ–∫ –µ—â—ë –≤—ã—à–µ */
.cselect__list{
  z-index: 9999;
  margin-top: 10px;
}

/* –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ–ª–µ–∫—Ç –Ω–∞–¥ –≤—Å–µ–º–∏ */
.cselect.open{
  z-index: 99999;
}
#options.lettersGrid{
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(74px, 1fr));
  gap: 14px;
  padding: 14px 10px 6px;
}

/* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∏–¥ .opt —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Å–µ—Ç–∫–∞ –±—É–∫–≤ –∞–∫—Ç–∏–≤–Ω–∞ */
#options.lettersGrid .opt{
  height: 74px;
  min-height: 74px;
  width: 100%;
  border-radius: 16px;
  font-size: 34px;
  font-weight: 800;
  letter-spacing: 0.02em;

  display: flex;
  align-items: center;
  justify-content: center;

  background: rgba(10, 10, 12, 0.55);
  border: 1px solid rgba(255, 210, 90, 0.35);
  box-shadow:
    0 8px 18px rgba(0,0,0,.35),
    inset 0 0 0 1px rgba(255,255,255,.06);
}

#options.lettersGrid .opt:hover{
  transform: translateY(-1px);
  border-color: rgba(255, 210, 90, 0.7);
}

#options.lettersGrid .opt:active{
  transform: translateY(0px) scale(0.98);
}

#options.lettersGrid .opt:disabled{
  opacity: 0.35;
  filter: grayscale(30%);
  transform: none;
}

/* –ü–æ–ª–µ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ ‚Äî –∫—Ä—É–ø–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ */
#word.typedWord{
  font-size: 54px;
  font-weight: 900;
  letter-spacing: 0.08em;
  text-transform: uppercase;

  padding: 22px 18px;
  border-radius: 18px;

  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255, 210, 90, 0.22);
  box-shadow: 0 10px 26px rgba(0,0,0,.35);

  text-align: center;
}
</style>
</head>

<body>
<div class="wrap">

<header>
  <div>
    <h1>–ß–∏—Ç–∞—Ä–∏—É–º</h1>
    <div class="sub">–ú–∞–≥–∏—è —Å–∫–æ—Ä–æ—á—Ç–µ–Ω–∏—è</div>
  </div>
</header>

<!-- ================== –ì–õ–ê–í–ù–ê–Ø ================== -->
<section id="screen-main" class="screen active">
  <div class="card">
    <div style="font-weight:900;font-size:18px">–í—ã–±–æ—Ä –∏–≥—Ä—ã</div>

    <div class="games">
      <div class="gameCard" id="pickWordFlash">
        ‚ö° –ò—Å–∫—Ä–∞ –†–∞–∑—É–º–∞
        <div style="font-size:13px;color:var(--muted);margin-top:6px">
          –ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ. –°–ª–æ–≤–æ –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç ‚Äî —Ç—ã –æ—Ç–≤–µ—á–∞–µ—à—å, –Ω–µ –¥–∞–≤–∞—è –≤–Ω–∏–º–∞–Ω–∏—é —É–≥–∞—Å–Ω—É—Ç—å.
        </div>
      </div>
      <div class="gameCard" id="pickSurvival">
  üõ°Ô∏è –°—Ç—Ä–∞–∂ –ó–Ω–∞–Ω–∏–π
  <div style="font-size:13px;color:var(--muted);margin-top:6px">
    –û—à–∏–±–∫–∏ –æ—Ç–Ω–∏–º–∞—é—Ç —Å–∏–ª—ã. –¢—Ä–∏ –ø—Ä–æ–º–∞—Ö–∞ ‚Äî –∏ –º–∞–≥–∏—è —Ä–∞—Å—Å–µ–µ—Ç—Å—è.
  </div>
  </div>
      <div class="gameCard" id="pickOddOneOut">
  üîé –¢–µ–Ω—å –õ–∏—à–Ω–µ–≥–æ
  <div style="font-size:13px;color:var(--muted);margin-top:6px">
    –°—Ä–µ–¥–∏ —Å–ª–æ–≤ —Å–∫—Ä—ã—Ç–∞ –æ—à–∏–±–∫–∞. –ù–∞–π–¥–∏ —Ç–æ, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—é.
  </div>
</div>
     <div class="gameCard" id="pickLetterBuilder">
  üîÆ –ê–ª—Ö–∏–º–∏—è –°–ª–æ–≤–∞
  <div style="font-size:13px;color:var(--muted);margin-top:6px">
    –°–æ–µ–¥–∏–Ω–∏ —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –±—É–∫–≤—ã –≤ —Ü–µ–ª—å–Ω–æ–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ.
  </div>
</div>
      <div class="gameCard" id="btnStats">
  üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
</div>
     <div class="gameCard" id="openSettings">
  ‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏
</div>
    </div>
  </div>
</section>
<!-- ================== –ù–ê–°–¢–†–û–ô–ö–ò –û–ë–©–ò–ï ================== -->
<section id="screen-settings" class="screen">
  <div style="margin-bottom:12px;">
    <button class="btn btn-ghost" id="backFromSettings">‚Üê –ù–∞–∑–∞–¥</button>
  </div>

  <div class="card">
    <div style="font-weight:900;font-size:18px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>

    <!-- –ò–≥—Ä–æ–∫ -->
    <div style="margin-top:16px;font-weight:900;">–ê–∫—Ç–∏–≤–Ω—ã–π –∏–≥—Ä–æ–∫</div>
    <div class="cselect" data-for="settingsChildSelect" style="margin-top:8px;">
  <select id="settingsChildSelect"></select>
  <button type="button" class="cselect__btn"></button>
  <div class="cselect__list" role="listbox"></div>
</div>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞ -->
    <div style="margin-top:16px;font-weight:900;">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</div>
    <div style="display:flex; gap:10px; margin-top:8px;">
      <input id="newChildName" placeholder="–ò–º—è —Ä–µ–±—ë–Ω–∫–∞"/>
      <button class="btn btn-primary" id="addChildBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <!-- –ó–≤—É–∫ -->
    <div style="margin-top:20px;font-weight:900;">–ó–≤—É–∫</div>
    <div style="margin-top:8px;">
      <button class="btn" id="toggleSoundBtn">‚Äî</button>
    </div>
  </div>
</section>
<!-- ================== –ù–ê–°–¢–†–û–ô–ö–ò ================== -->
<section id="screen-setup" class="screen">
  <div class="card">
    <div style="font-weight:900;margin-bottom:12px">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>

<!--    <input id="childName" placeholder="–ò–º—è —Ä–µ–±—ë–Ω–∫–∞"/>-->
<!--    <button class="btn" onclick="createChild()">–î–æ–±–∞–≤–∏—Ç—å</button>-->
<!--    <button class="btn" onclick="loadChildren()">–û–±–Ω–æ–≤–∏—Ç—å</button>-->

    <div style="font-weight:900;margin-top:12px">–í—ã–±–µ—Ä–∏ –≤–æ–ª—à–µ–±–Ω–∏–∫–∞</div>

     <div class="cselect" data-for="childSelect">
      <select id="childSelect"></select>
       <button type="button" class="cselect__btn"></button>
      <div class="cselect__list" role="listbox"></div>
    </div>

    <div style="font-weight:900;margin-top:12px">–í—ã–±–µ—Ä–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å</div>

    <div class="cselect" data-for="difficultySelect">
      <select id="difficultySelect">
        <option value="easy">–ù–æ–≤–∏—á–æ–∫</option>
        <option value="normal" selected>–£—á–µ–Ω–∏–∫</option>
        <option value="hard">–ú–∞—Å—Ç–µ—Ä</option>
      </select>
      <button type="button" class="cselect__btn"></button>
      <div class="cselect__list" role="listbox"></div>
    </div>

    <div style="font-weight:900;margin-top:12px">–í—ã–±–µ—Ä–∏ —Ç–µ–º—É</div>
    <div class="cselect" data-for="themeSelect">
      <select id="themeSelect"></select>
      <button type="button" class="cselect__btn"></button>
      <div class="cselect__list" role="listbox"></div>
      <div class="cselect__list" role="listbox"></div>
    </div>

    <div style="margin-top:16px;display:flex;justify-content:space-between">
      <button class="btn" id="backToMain">‚Üê –ù–∞–∑–∞–¥</button>
      <button class="btn btn-primary" id="startGameBtn">–ù–∞—á–∞—Ç—å ‚Üí</button>
</div>
  </div>
</section>

<!-- ================== –ò–ì–†–ê ================== -->
<section id="screen-play" class="screen">
  <div style="margin-bottom:12px">
    <button class="btn" id="exitGame">‚Üê –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>

  <div class="card">
    <div id="toast"></div>

    <div id="livesHud" style="margin:10px 0; font-weight:900; letter-spacing:.5px;"></div>
    <div class="progress"><div id="progressBar"></div></div>

    <div class="wordBox">
      <div id="word" class="word hidden">—Å–ª–æ–≤–æ</div>
    </div>

    <div class="options" id="options"></div>


    <div style="margin-top:12px;display:flex;justify-content:space-between">
      <button class="btn" id="btnRestart" onclick="restart()" disabled>–°–Ω–∞—á–∞–ª–∞</button>
      <button class="btn btn-primary" id="btnPlay" onclick="start()">‚ñ∂ –ò–≥—Ä–∞—Ç—å</button>
    </div>
  </div>
</section>

  <!-- ================== –†–ï–ó–£–õ–¨–¢–ê–¢ ================== -->
<section id="screen-result" class="screen">
  <div style="margin-bottom:12px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
    <button class="btn btn-ghost" id="backToSetupFromResult">‚Üê –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    <button class="btn btn-primary" id="playAgainFromResult">–ò–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑ ‚ñ∂</button>
  </div>

  <div class="card">
    <div style="font-weight:900; font-size:18px;">–ò—Ç–æ–≥ —É—Ä–æ–∫–∞</div>
    <div style="color:var(--muted); font-weight:900; margin-top:6px;">
      –û—Ç–ª–∏—á–Ω–æ. –ü–æ—Å–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.
    </div>

    <!-- –í–ê–ñ–ù–û: –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ ID –∂–¥—ë—Ç game.wordflash.js -->
    <div id="resultBlock" style="display:none; margin-top:16px;">
      <div class="stars" id="stars" style="display:flex; gap:10px; font-size:28px; margin-top:8px;">
        <span class="star">‚òÖ</span><span class="star">‚òÖ</span><span class="star">‚òÖ</span>
      </div>

      <div class="kpi" style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:12px;">
        <div class="box" style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div class="val" id="kpiAcc" style="font-size:22px; font-weight:900;">‚Äî</div>
          <div class="lbl" style="color:var(--muted); font-weight:900; font-size:13px;">–¢–æ—á–Ω–æ—Å—Ç—å</div>
        </div>
        <div class="box" style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div class="val" id="kpiReact" style="font-size:22px; font-weight:900;">‚Äî</div>
          <div class="lbl" style="color:var(--muted); font-weight:900; font-size:13px;">–†–µ–∞–∫—Ü–∏—è</div>
        </div>
        <div class="box" style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div class="val" id="kpiNext" style="font-size:22px; font-weight:900;">‚Äî</div>
          <div class="lbl" style="color:var(--muted); font-weight:900; font-size:13px;">–°–ª–µ–¥—É—é—â–∏–π –ø–æ–∫–∞–∑</div>
        </div>
      </div>
    </div>
    <div id="survivalResult" style="display:none; margin-top:14px;">
  <div style="font-weight:800; margin-bottom:8px;">–ò—Ç–æ–≥–∏ –≤—ã–∂–∏–≤–∞–Ω–∏—è</div>

  <div class="kpis">
    <div class="kpi">
      <div class="kpiLabel">–ñ–∏–∑–Ω–∏</div>
      <div class="kpiValue" id="kpiLives">‚Äî</div>
    </div>

    <div class="kpi">
      <div class="kpiLabel">–í—Ä–µ–º—è</div>
      <div class="kpiValue" id="kpiTime">‚Äî</div>
    </div>

    <div class="kpi">
      <div class="kpiLabel">–°–µ—Ä–∏—è</div>
      <div class="kpiValue" id="kpiStreak">‚Äî</div>
    </div>

    <div class="kpi">
      <div class="kpiLabel">–û—à–∏–±–∫–∏</div>
      <div class="kpiValue" id="kpiWrong">‚Äî</div>
    </div>
  </div>

  <div id="survivalEndReason" style="margin-top:10px; color: var(--muted);"></div>
</div>
    <div id="resultEmptyHint" style="margin-top:12px; color:var(--muted); font-weight:900;">
      –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞.
    </div>
  </div>
</section>
 <!-- ================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ================== -->
<section id="screen-stats" class="screen">
  <div style="margin-bottom:12px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
    <button class="btn btn-ghost" id="backFromStats">‚Üê –ù–∞–∑–∞–¥</button>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn" id="tabStatsChild">üë§ –í—ã–±—Ä–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫</button>
      <button class="btn btn-primary" id="tabStatsAll">üë• –í—Å–µ –∏–≥—Ä–æ–∫–∏</button>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:900;font-size:18px">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
    <div style="color:var(--muted); font-weight:900; margin-top:6px" id="statsSubtitle">
      ‚Äî
    </div>

    <!-- ===== –í–∫–ª–∞–¥–∫–∞: –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–≥—Ä–æ–∫ ===== -->
    <div id="statsChildView" style="margin-top:16px; display:none;">
      <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
        <div style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div style="font-size:22px;font-weight:900;" id="childTotalSessions">‚Äî</div>
          <div style="color:var(--muted);font-weight:900;font-size:13px;">–í—Å–µ–≥–æ –∏–≥—Ä</div>
        </div>
        <div style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div style="font-size:22px;font-weight:900;" id="childAvgAcc">‚Äî</div>
          <div style="color:var(--muted);font-weight:900;font-size:13px;">–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
        </div>
        <div style="border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:rgba(0,0,0,.18);">
          <div style="font-size:22px;font-weight:900;" id="childAvgReact">‚Äî</div>
          <div style="color:var(--muted);font-weight:900;font-size:13px;">–°—Ä–µ–¥–Ω—è—è —Ä–µ–∞–∫—Ü–∏—è</div>
        </div>
      </div>

      <div style="margin-top:14px; font-weight:900;">–ü–æ —Ä–µ–∂–∏–º–∞–º</div>
      <div id="childModesTable" style="margin-top:10px; overflow:auto;"></div>
      <div style="margin-top:16px; font-weight:900;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
      <div id="childAchievements" style="margin-top:10px;"></div>
    </div>

    <!-- ===== –í–∫–ª–∞–¥–∫–∞: –≤—Å–µ –∏–≥—Ä–æ–∫–∏ ===== -->
    <div id="statsAllView" style="margin-top:16px; display:none;">
      <div style="font-weight:900;">–ò–≥—Ä–æ–∫–∏ –∏ —Ä–µ–∂–∏–º—ã</div>
      <div id="allPlayersTable" style="margin-top:10px; overflow:auto;"></div>
    </div>

    <div id="statsEmpty" style="margin-top:12px; color:var(--muted); font-weight:900; display:none;">
      –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö: —Å—ã–≥—Ä–∞–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∏–≥—Ä—É.
    </div>
  </div>
</section>

</div>
<script>
  function setBodyScreen(name){
    document.body.classList.remove("screen-main","screen-setup","screen-play","screen-result");
    document.body.classList.add("screen-" + name);
  }

  // –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–æ–≤—ã–π
  setBodyScreen("main");
</script>
<script src="/static/js/game.wordflash.js"></script>

<script>
const sMain  = document.getElementById("screen-main");
const sSetup = document.getElementById("screen-setup");
const sPlay  = document.getElementById("screen-play");
const sRes   = document.getElementById("screen-result");

function show(screen){
  const sStats = document.getElementById("screen-stats");
const sSettings = document.getElementById("screen-settings");
[sMain, sSetup, sPlay, sRes, sStats, sSettings]
  .filter(Boolean)
  .forEach(s => s.classList.remove("active"));
  if(screen==="settings") sSettings.classList.add("active");
  if(screen==="main")   sMain.classList.add("active");
  if(screen==="setup")  sSetup.classList.add("active");
  if(screen==="play")   sPlay.classList.add("active");
  if(screen==="result") sRes.classList.add("active");
  if(screen==="stats")  sStats.classList.add("active");

  document.body.className = "screen-" + screen;
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
window.rg_selected_mode = "word_flash";
document.getElementById("pickWordFlash").onclick = () => {
  window.rg_selected_mode = "word_flash";
  show("setup");
};

document.getElementById("pickSurvival").onclick = () => {
  window.rg_selected_mode = "survival";
  show("setup");
};

document.getElementById("pickOddOneOut").onclick = () => {
  window.rg_selected_mode = "odd_one_out";
  show("setup");
};

document.getElementById("pickLetterBuilder").onclick = () => {
  window.rg_selected_mode = "letter_builder";
  show("setup");
};

document.getElementById("btnStats").onclick = async () => {
  const sel = document.getElementById("childSelect");
  if (!sel || !sel.value) {
    alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–±—ë–Ω–∫–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö");
    return;
  }

  const childId = parseInt(sel.value, 10);

  const res = await fetch(`/api/stats/${childId}`);
  const data = await res.json();

  document.getElementById("statsGames").textContent = data.total_sessions;
  document.getElementById("statsAcc").textContent =
    Math.round(data.avg_accuracy * 100) + "%";
  document.getElementById("statsReact").textContent =
    Math.round(data.avg_reaction_ms) + " –º—Å";

  show("stats");
};

document.getElementById("backFromStats").onclick = () => show("main");

document.getElementById("backToMain").onclick = () => show("main");

document.getElementById("startGameBtn").onclick = () => {
  show("play");
  if(typeof start === "function") start();
};

document.getElementById("exitGame").onclick = () => {
  if(typeof restart === "function") restart();
  show("setup");
};

document.getElementById("backToSetupFromResult").onclick = () => show("setup");

document.getElementById("playAgainFromResult").onclick = () => {
  show("play");
  if(typeof start === "function") start();
};

// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º finish() –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
window.addEventListener("load", () => {
  if (typeof window.finish === "function") {
    const originalFinish = window.finish;

    window.finish = function(...args){
      const result = originalFinish.apply(this, args);
      show("result");
      return result;
    };
  }
});

// ===== Stats UI =====
const MODE_TITLES = {
  word_flash: "‚ö° –ò—Å–∫—Ä–∞ –†–∞–∑—É–º–∞",
  survival: "üõ°Ô∏è –°—Ç—Ä–∞–∂ –ó–Ω–∞–Ω–∏–π",
  odd_one_out: "üîé –¢–µ–Ω—å –õ–∏—à–Ω–µ–≥–æ",
  letter_builder: "üîÆ –ê–ª—Ö–∏–º–∏—è –°–ª–æ–≤–∞"
};

function fmtPct01(x){
  const v = Number(x || 0);
  return Math.round(v * 100) + "%";
}
function fmtMs(x){
  const v = Number(x || 0);
  return Math.round(v) + " –º—Å";
}

function setStatsTab(tab){
  const vChild = document.getElementById("statsChildView");
  const vAll = document.getElementById("statsAllView");
  const bChild = document.getElementById("tabStatsChild");
  const bAll = document.getElementById("tabStatsAll");

  if(tab === "child"){
    vChild.style.display = "block";
    vAll.style.display = "none";
    bChild.classList.add("btn-primary");
    bAll.classList.remove("btn-primary");
  } else {
    vAll.style.display = "block";
    vChild.style.display = "none";
    bAll.classList.add("btn-primary");
    bChild.classList.remove("btn-primary");
  }
}

function renderChildModes(childData){
  // childData: {child_id, child_name, total_sessions, modes:[...]}
  const subtitle = document.getElementById("statsSubtitle");
  subtitle.textContent = `–ò–≥—Ä–æ–∫: ${childData.child_name}`;

  document.getElementById("childTotalSessions").textContent = childData.total_sessions;

  // –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –≤—Å–µ–º —Ä–µ–∂–∏–º–∞–º
  let attempts = 0, accSum = 0, reactSum = 0;
  (childData.modes || []).forEach(m => {
    attempts += (m.attempts || 0);
    accSum += (m.avg_accuracy || 0) * (m.attempts || 0);
    reactSum += (m.avg_reaction_ms || 0) * (m.attempts || 0);
  });

  const avgAcc = attempts ? (accSum / attempts) : 0;
  const avgReact = attempts ? (reactSum / attempts) : 0;

  document.getElementById("childAvgAcc").textContent = fmtPct01(avgAcc);
  document.getElementById("childAvgReact").textContent = fmtMs(avgReact);

  const wrap = document.getElementById("childModesTable");
  const rows = (childData.modes || []).map(m => `
    <tr>
      <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18); font-weight:900;">
        ${MODE_TITLES[m.mode] || m.mode}
      </td>
      <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${m.sessions}</td>
      <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${m.attempts}</td>
      <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${fmtPct01(m.avg_accuracy)}</td>
      <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${fmtMs(m.avg_reaction_ms)}</td>
    </tr>
  `).join("");

  wrap.innerHTML = `
    <table style="width:100%; border-collapse:collapse; border:1px solid rgba(212,175,55,.22); border-radius:14px; overflow:hidden;">
      <thead>
        <tr style="background:rgba(0,0,0,.22);">
          <th style="text-align:left; padding:10px 12px;">–†–µ–∂–∏–º</th>
          <th style="text-align:left; padding:10px 12px;">–ò–≥—Ä—ã</th>
          <th style="text-align:left; padding:10px 12px;">–û—Ç–≤–µ—Ç—ã</th>
          <th style="text-align:left; padding:10px 12px;">–¢–æ—á–Ω–æ—Å—Ç—å</th>
          <th style="text-align:left; padding:10px 12px;">–†–µ–∞–∫—Ü–∏—è</th>
        </tr>
      </thead>
      <tbody>${rows || ""}</tbody>
    </table>
  `;
}

async function loadChildAchievements(childId){
  const list = await (await fetch(`/api/children/${childId}/achievements`)).json();
  renderChildAchievements(list);
}

function renderChildAchievements(list){
  const wrap = document.getElementById("childAchievements");
  if (!wrap) return;

  if (!list || !list.length) {
    wrap.innerHTML = `<div style="color:rgba(242,232,201,.7);font-weight:900;">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.</div>`;
    return;
  }

  const unlocked = list.filter(x => x.unlocked);
  const locked = list.filter(x => !x.unlocked);

  const makeCard = (a, isLocked) => `
    <div style="
      border:1px solid rgba(212,175,55,.22);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(0,0,0,.18);
      opacity:${isLocked ? 0.45 : 1};
      display:flex;
      gap:10px;
      align-items:flex-start;
    ">
      <div style="font-size:22px; width:28px; text-align:center;">${a.icon || "üèÜ"}</div>
      <div>
        <div style="font-weight:900;">${a.title || a.code}</div>
        <div style="color:rgba(242,232,201,.75); font-weight:800; font-size:13px; margin-top:2px;">
          ${a.description || ""}
        </div>
      </div>
    </div>
  `;

  wrap.innerHTML = `
    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
      <div style="border:1px solid rgba(212,175,55,.22); border-radius:999px; padding:6px 10px; background:rgba(0,0,0,.18); font-weight:900;">
        –ü–æ–ª—É—á–µ–Ω–æ: ${unlocked.length} / ${list.length}
      </div>
    </div>

    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:10px;">
      ${unlocked.map(a => makeCard(a, false)).join("")}
      ${locked.map(a => makeCard(a, true)).join("")}
    </div>
  `;
}
function renderAllPlayers(allData){
  // allData: {total_children, children:[{child_name, modes:[...]}]}
  const subtitle = document.getElementById("statsSubtitle");
  subtitle.textContent = `–ò–≥—Ä–æ–∫–æ–≤: ${allData.total_children}`;

  const wrap = document.getElementById("allPlayersTable");

  const rows = (allData.children || []).flatMap(ch => {
    const modes = (ch.modes || []);
    if (!modes.length) {
      return [`
        <tr>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18); font-weight:900;">${ch.child_name}</td>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">‚Äî</td>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">0</td>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">0</td>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">0%</td>
          <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">0 –º—Å</td>
        </tr>
      `];
    }
    return modes.map(m => `
      <tr>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18); font-weight:900;">${ch.child_name}</td>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${MODE_TITLES[m.mode] || m.mode}</td>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${m.sessions}</td>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${m.attempts}</td>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${fmtPct01(m.avg_accuracy)}</td>
        <td style="padding:10px 12px; border-bottom:1px solid rgba(212,175,55,.18);">${fmtMs(m.avg_reaction_ms)}</td>
      </tr>
    `);
  }).join("");

  wrap.innerHTML = `
    <table style="width:100%; border-collapse:collapse; border:1px solid rgba(212,175,55,.22); border-radius:14px; overflow:hidden;">
      <thead>
        <tr style="background:rgba(0,0,0,.22);">
          <th style="text-align:left; padding:10px 12px;">–ò–≥—Ä–æ–∫</th>
          <th style="text-align:left; padding:10px 12px;">–†–µ–∂–∏–º</th>
          <th style="text-align:left; padding:10px 12px;">–ò–≥—Ä—ã</th>
          <th style="text-align:left; padding:10px 12px;">–û—Ç–≤–µ—Ç—ã</th>
          <th style="text-align:left; padding:10px 12px;">–¢–æ—á–Ω–æ—Å—Ç—å</th>
          <th style="text-align:left; padding:10px 12px;">–†–µ–∞–∫—Ü–∏—è</th>
        </tr>
      </thead>
      <tbody>${rows || ""}</tbody>
    </table>
  `;
}

async function loadStatsAll(){
  document.getElementById("statsEmpty").style.display = "none";
  const data = await (await fetch("/api/stats/children")).json();
  // –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∏–≥—Ä
  const anySessions = (data.children || []).some(c => (c.total_sessions || 0) > 0);
  if (!anySessions) document.getElementById("statsEmpty").style.display = "block";
  renderAllPlayers(data);
}

async function loadStatsChild(){
  document.getElementById("statsEmpty").style.display = "none";
  const sel = document.getElementById("childSelect");
  if (!sel || !sel.value) { document.getElementById("statsEmpty").style.display = "block"; return; }

  const childId = parseInt(sel.value, 10);
  const data = await (await fetch(`/api/stats/children/${childId}`)).json();
  if (!data.total_sessions) document.getElementById("statsEmpty").style.display = "block";
  renderChildModes(data);
  await loadChildAchievements(childId);
}

// –∫–Ω–æ–ø–∫–∏/—Ç–∞–±—ã
document.getElementById("tabStatsAll").onclick = async () => {
  setStatsTab("all");
  await loadStatsAll();
};
document.getElementById("tabStatsChild").onclick = async () => {
  setStatsTab("child");
  await loadStatsChild();
};
document.getElementById("backFromStats").onclick = () => show("main");

// –≤—Ö–æ–¥ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å –≥–ª–∞–≤–Ω–æ–π
document.getElementById("btnStats").onclick = async () => {
  show("stats");
  // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ–º "–í—Å–µ –∏–≥—Ä–æ–∫–∏"
  setStatsTab("all");
  await loadStatsAll();
};
</script>
<script>
(() => {
  // 1) –°–æ–∑–¥–∞—ë–º canvas, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
  let canvas = document.getElementById("sparkCanvas");
  if (!canvas) {
    canvas = document.createElement("canvas");
    canvas.id = "sparkCanvas";
    canvas.setAttribute("aria-hidden", "true");
    document.body.appendChild(canvas);
  }

  // 2) –°—Ç–∏–ª–∏ —á–µ—Ä–µ–∑ JS (—á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç CSS)
  Object.assign(canvas.style, {
    position: "fixed",
    left: "0",
    top: "0",
    width: "100vw",
    height: "100vh",
    pointerEvents: "none",
    zIndex: "999999"
  });

  const ctx = canvas.getContext("2d", { alpha: true });
  if (!ctx) return;

  // 3) Resize + DPR
  let dpr = 1;
  function resize() {
    dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const w = Math.floor(window.innerWidth * dpr);
    const h = Math.floor(window.innerHeight * dpr);
    canvas.width = w;
    canvas.height = h;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0); // —Ä–∏—Å—É–µ–º –≤ CSS-–ø–∏–∫—Å–µ–ª—è—Ö
  }
  window.addEventListener("resize", resize, { passive: true });
  resize();

  // 4) –ß–∞—Å—Ç–∏—Ü—ã
  const P = [];
  const MAX = 120;
  const LIFE = 380;           // –º—Å
  const SPAWN = 1;            // —á–∞—Å—Ç–∏—Ü –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ
  const SPEED = 0.35;
  const DRAG = 0.992;

  const palette = [
    [212, 175, 55],
    [242, 193, 78],
    [139, 92, 246]
  ];

  function spawn(x, y) {
    for (let i = 0; i < SPAWN; i++) {
      if (P.length >= MAX) P.shift();
      const ang = Math.random() * Math.PI * 2;
      const sp = (0.6 + Math.random() * 1.2) * SPEED;
      const [cr, cg, cb] = palette[(Math.random() * palette.length) | 0];

      P.push({
        x: x + (Math.random() * 6 - 3),
        y: y + (Math.random() * 6 - 3),
        vx: Math.cos(ang) * sp,
        vy: Math.sin(ang) * sp,
        r: 1.2 + Math.random() * 2.0,
        life: LIFE,
        ttl: LIFE,
        cr, cg, cb,
        rot: Math.random() * Math.PI * 2,
        spin: (Math.random() * 0.12 + 0.03) * (Math.random() < 0.5 ? -1 : 1),
      });
    }
  }
// –ü—É–±–ª–∏—á–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ –∏—Å–∫—Ä (–º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤)
window.sparksBurst = function (x, y, n = 36) {
  for (let i = 0; i < n; i++) {
    spawn(x, y);

    const p = P[P.length - 1];
    if (!p) continue;

    // —É—Å–∏–ª–µ–Ω–∏–µ –≤—Å–ø—ã—à–∫–∏
    p.vx *= 2.2;
    p.vy *= 2.2;
    p.r *= 1.6;
    p.life *= 1.15;

    // —è—Ä—á–µ —Ü–≤–µ—Ç
    p.cr = 255;
    p.cg = 215;
    p.cb = 80;
  }
};
  // –í–∞–∂–Ω–æ: —Å–ª—É—à–∞–µ–º –∏–º–µ–Ω–Ω–æ document, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç overlay/—ç–ª–µ–º–µ–Ω—Ç–æ–≤
  document.addEventListener("mousemove", (e) => {
    spawn(e.clientX, e.clientY);
  }, { passive: true });

  document.addEventListener("touchmove", (e) => {
    const t = e.touches && e.touches[0];
    if (!t) return;
    spawn(t.clientX, t.clientY);
  }, { passive: true });

  function star(x, y, r, rot, a, cr, cg, cb) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    ctx.globalAlpha = a;
    ctx.fillStyle = `rgb(${cr},${cg},${cb})`;
    ctx.beginPath();
    ctx.moveTo(0, -r);
    ctx.lineTo(r * 0.55, 0);
    ctx.lineTo(0, r);
    ctx.lineTo(-r * 0.55, 0);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  let last = performance.now();
  function tick(t) {
    const dt = Math.min(32, t - last);
    last = t;

    // clear –≤ CSS-–ø–∏–∫—Å–µ–ª—è—Ö (–ø–æ—Å–ª–µ setTransform!)
    ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

    for (let i = P.length - 1; i >= 0; i--) {
      const p = P[i];
      p.life -= dt;
      if (p.life <= 0) { P.splice(i, 1); continue; }

      p.vx *= DRAG;
      p.vy *= DRAG;

      p.x += p.vx * dt;
      p.y += p.vy * dt;
      p.rot += p.spin * dt;

      const k = p.life / p.ttl;       // 1..0
      const a = Math.pow(k, 1.6);
      const r = p.r * (0.9 + (1 - k) * 0.35);

      // –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
      ctx.globalCompositeOperation = "lighter";
      ctx.globalAlpha = a * 0.12;
      ctx.fillStyle = `rgb(${p.cr},${p.cg},${p.cb})`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, r * 1.8, 0, Math.PI * 2);
      ctx.fill();

      // –∏—Å–∫–æ—Ä–∫–∞
      ctx.globalCompositeOperation = "source-over";
      star(p.x, p.y, r, p.rot, a, p.cr, p.cg, p.cb);
    }

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // quick sanity log (–º–æ–∂–µ—à—å –ø–æ—Ç–æ–º —É–±—Ä–∞—Ç—å)
  console.log("[sparks] enabled");
})();
</script>
<script>
(function(){
  function build(wrapper){
    const selId = wrapper.getAttribute("data-for");
    const select = document.getElementById(selId);
    const btn = wrapper.querySelector(".cselect__btn");
    const list = wrapper.querySelector(".cselect__list");

    if(!select || !btn || !list) return;

    function render(){
      list.innerHTML = "";
      const currentIndex = select.selectedIndex;

      [...select.options].forEach((opt, idx) => {
        const div = document.createElement("div");
        div.className = "cselect__opt";
        div.textContent = opt.textContent;
        div.setAttribute("role","option");
        div.setAttribute("data-idx", String(idx));
        div.setAttribute("aria-selected", idx === currentIndex ? "true" : "false");

        div.addEventListener("click", () => {
          select.selectedIndex = idx;
          select.dispatchEvent(new Event("change", { bubbles: true }));
          closeAll();
        });

        list.appendChild(div);
      });

      btn.textContent = select.options[select.selectedIndex]?.textContent || "";
    }

    function toggle(){
      const isOpen = wrapper.classList.contains("open");
      closeAll();
      if(!isOpen) wrapper.classList.add("open");
    }

    btn.addEventListener("click", toggle);

    // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –µ—Å–ª–∏ select –º–µ–Ω—è–µ—Ç—Å—è –∏–∑ —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞
    select.addEventListener("change", render);

    render();
  }

  function closeAll(){
    document.querySelectorAll(".cselect.open").forEach(x => x.classList.remove("open"));
  }

  document.addEventListener("click", (e) => {
    if(!e.target.closest(".cselect")) closeAll();
  });

  window.addEventListener("load", () => {
    document.querySelectorAll(".cselect[data-for]").forEach(build);
  });
})();
</script>
<script>
  document.addEventListener("click", (e) => {
    const btn = e.target.closest("#options .opt");
    if (!btn) return;

    const r = btn.getBoundingClientRect();
    const x = e.clientX || (r.left + r.width/2);
    const y = e.clientY || (r.top + r.height/2);

    if (typeof window.sparksBurst !== "function") return;

    // —á—É—Ç—å —Å–∏–ª—å–Ω–µ–µ –¥–ª—è ok
    if (btn.classList.contains("ok")) window.sparksBurst(x, y, 34, 1.9);
    else window.sparksBurst(x, y, 22, 1.4);
  }, { passive: true });

  // ===== SETTINGS =====

async function loadSettingsChildren(){
  const sel = document.getElementById("settingsChildSelect");
  const gameSel = document.getElementById("childSelect");
  if (!sel) return;

  const list = await (await fetch("/api/children")).json();

  sel.innerHTML = "";
  list.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c.id;
    opt.textContent = c.name;
    sel.appendChild(opt);
  });

  // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å –∏–≥—Ä–æ–≤—ã–º —Å–µ–ª–µ–∫—Ç–æ–º
  if (gameSel && gameSel.value) sel.value = gameSel.value;
  sel.dispatchEvent(new Event("change", { bubbles: true }));
}

function syncActiveChild(){
  const sel = document.getElementById("settingsChildSelect");
  const gameSel = document.getElementById("childSelect");
  if (!sel || !gameSel) return;

  gameSel.value = sel.value;
  gameSel.dispatchEvent(new Event("change", { bubbles:true }));
}

async function addNewChild(){
  const input = document.getElementById("newChildName");
  const name = input.value.trim();
  if (!name) return;

  await fetch("/api/children", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({name})
  });

  input.value = "";
  await loadSettingsChildren();
  await loadChildren(); // –∏–∑ game.wordflash.js
}

function updateSoundButton(){
  const btn = document.getElementById("toggleSoundBtn");
  if (!btn) return;

  const on = localStorage.getItem("rg_sound_on");
  const enabled = (on === null || on === "1");

  btn.textContent = enabled ? "üîä –ó–≤—É–∫ –≤–∫–ª—é—á—ë–Ω" : "üîá –ó–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω";
}

function toggleSoundFromSettings(){
  if (typeof window.toggleSound === "function") {
    window.toggleSound();
  }
  updateSoundButton();
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
document.getElementById("openSettings").onclick = async () => {
  await loadSettingsChildren();
  updateSoundButton();
  show("settings");
};

document.getElementById("backFromSettings").onclick = () => show("main");

document.getElementById("settingsChildSelect").onchange = syncActiveChild;
document.getElementById("addChildBtn").onclick = addNewChild;
document.getElementById("toggleSoundBtn").onclick = toggleSoundFromSettings;
</script>

</body>
</html>